# Marimo Notebook å¤‰æ•°å‘½åãƒ«ãƒ¼ãƒ«

## ğŸš¨ é‡è¦ãªåˆ¶ç´„

Marimoãƒãƒ¼ãƒˆãƒ–ãƒƒã‚¯ã§ã¯**å¤‰æ•°ã®å†å®šç¾©ãŒç¦æ­¢**ã•ã‚Œã¦ã„ã¾ã™ã€‚ç•°ãªã‚‹ã‚»ãƒ«é–“ã§åŒã˜å¤‰æ•°åã‚’ä½¿ç”¨ã™ã‚‹ã¨ã‚¨ãƒ©ãƒ¼ã«ãªã‚Šã¾ã™ã€‚

## âœ… æ­£ã—ã„å‘½åãƒ‘ã‚¿ãƒ¼ãƒ³

### 1. ãƒ«ãƒ¼ãƒ—å¤‰æ•°ã«ã¯å›ºæœ‰ã®æ¥å°¾è¾ã‚’ä»˜ã‘ã‚‹

```python
# âŒ æ‚ªã„ä¾‹ï¼ˆè¤‡æ•°ã®ã‚»ãƒ«ã§åŒã˜å¤‰æ•°åï¼‰
@app.cell
def _(data):
    for idx, (name, value) in enumerate(data.items()):
        process(name, value)
    return idx, name, value  # ã“ã‚Œã‚‰ã®å¤‰æ•°ãŒä»–ã®ã‚»ãƒ«ã¨è¡çªã™ã‚‹

# âœ… è‰¯ã„ä¾‹ï¼ˆã‚»ãƒ«ã”ã¨ã«å›ºæœ‰ã®æ¥å°¾è¾ï¼‰
@app.cell
def _(data):
    for idx_proc, (name_proc, value_proc) in enumerate(data.items()):
        process(name_proc, value_proc)
    return idx_proc, name_proc, value_proc
```

### 2. ã‚»ãƒ«å›ºæœ‰ã®ãƒ—ãƒ¬ãƒ•ã‚£ãƒƒã‚¯ã‚¹/ã‚µãƒ•ã‚£ãƒƒã‚¯ã‚¹ã‚’ä½¿ç”¨

```python
# âŒ æ‚ªã„ä¾‹
@app.cell
def _(df):
    fig, axes = plt.subplots(2, 2)
    for idx, ax in enumerate(axes.flatten()):
        ax.plot(data[idx])
    return fig, axes, idx, ax

@app.cell
def _(df):
    fig, axes = plt.subplots(3, 3)  # ã‚¨ãƒ©ãƒ¼: fig, axes ãŒå†å®šç¾©
    return fig, axes

# âœ… è‰¯ã„ä¾‹
@app.cell
def _(df):
    fig_overview, axes_overview = plt.subplots(2, 2)
    for idx_ov, ax_ov in enumerate(axes_overview.flatten()):
        ax_ov.plot(data[idx_ov])
    return fig_overview, axes_overview

@app.cell
def _(df):
    fig_detail, axes_detail = plt.subplots(3, 3)
    for idx_det, ax_det in enumerate(axes_detail.flatten()):
        ax_det.plot(data[idx_det])
    return fig_detail, axes_detail
```

### 3. ãƒ‡ãƒ¼ã‚¿å‡¦ç†ã®æ®µéšã”ã¨ã«ç•°ãªã‚‹å¤‰æ•°å

```python
# âŒ æ‚ªã„ä¾‹
@app.cell
def _(raw_data):
    for row in raw_data:
        process(row)
    return row

@app.cell
def _(processed_data):
    for row in processed_data:  # ã‚¨ãƒ©ãƒ¼: row ãŒå†å®šç¾©
        analyze(row)
    return row

# âœ… è‰¯ã„ä¾‹
@app.cell
def _(raw_data):
    for row_raw in raw_data:
        process(row_raw)
    return row_raw

@app.cell
def _(processed_data):
    for row_proc in processed_data:
        analyze(row_proc)
    return row_proc
```

## ğŸ“ å‘½åè¦å‰‡ã®ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹

### ã‚»ãƒ«ç›®çš„åˆ¥ã®æ¥å°¾è¾æ¨å¥¨ä¾‹

| ã‚»ãƒ«ã®ç›®çš„ | æ¨å¥¨æ¥å°¾è¾ | ä¾‹ |
|----------|---------|---|
| ãƒ‡ãƒ¼ã‚¿å–å¾— | `_fetch`, `_load` | `df_fetch`, `result_load` |
| å‰å‡¦ç† | `_prep`, `_clean` | `data_prep`, `values_clean` |
| çµ±è¨ˆåˆ†æ | `_stat`, `_calc` | `mean_stat`, `corr_calc` |
| å¯è¦–åŒ–ï¼ˆé™çš„ï¼‰ | `_static`, `_plot` | `fig_static`, `ax_plot` |
| å¯è¦–åŒ–ï¼ˆå‹•çš„ï¼‰ | `_dyn`, `_inter` | `net_dyn`, `chart_inter` |
| ãƒ¢ãƒ‡ãƒ«å­¦ç¿’ | `_train`, `_fit` | `model_train`, `scaler_fit` |
| è©•ä¾¡ | `_eval`, `_test` | `score_eval`, `pred_test` |
| ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ | `_report`, `_out` | `content_report`, `path_out` |

### ã‚°ãƒ«ãƒ¼ãƒ—/ã‚«ãƒ†ã‚´ãƒªåˆ¥ã®æ¥å°¾è¾

```python
# ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯åˆ†æã§ã®ä¾‹
for idx_net, (group_name_net, data_net) in enumerate(networks.items()):
    G_net = data_net['graph']
    pos_net = nx.spring_layout(G_net)
    # ...

# ãƒ’ãƒ¼ãƒˆãƒãƒƒãƒ—æç”»ã§ã®ä¾‹
for idx_heat, (group_name_heat, data_heat) in enumerate(heatmap_data.items()):
    values_heat = data_heat['values']
    # ...
```

## ğŸ” ã‚ˆãã‚ã‚‹ã‚¨ãƒ©ãƒ¼ãƒ‘ã‚¿ãƒ¼ãƒ³ã¨ä¿®æ­£

### ãƒ‘ã‚¿ãƒ¼ãƒ³1: ãƒ«ãƒ¼ãƒ—ã‚«ã‚¦ãƒ³ã‚¿ã®è¡çª

```python
# âŒ æ‚ªã„
for idx in range(10): ...
for idx in range(5): ...  # åˆ¥ã®ã‚»ãƒ«ã§ã‚¨ãƒ©ãƒ¼

# âœ… è‰¯ã„
for idx_first in range(10): ...
for idx_second in range(5): ...
```

### ãƒ‘ã‚¿ãƒ¼ãƒ³2: ä¸€æ™‚å¤‰æ•°ã®è¡çª

```python
# âŒ æ‚ªã„
G = build_graph(data1)
G = build_graph(data2)  # åˆ¥ã®ã‚»ãƒ«ã§ã‚¨ãƒ©ãƒ¼

# âœ… è‰¯ã„
G_main = build_graph(data1)
G_compare = build_graph(data2)
```

### ãƒ‘ã‚¿ãƒ¼ãƒ³3: ãƒ—ãƒ­ãƒƒãƒˆå¤‰æ•°ã®è¡çª

```python
# âŒ æ‚ªã„
fig, ax = plt.subplots()
fig, ax = plt.subplots()  # åˆ¥ã®ã‚»ãƒ«ã§ã‚¨ãƒ©ãƒ¼

# âœ… è‰¯ã„
fig_time, ax_time = plt.subplots()
fig_dist, ax_dist = plt.subplots()
```

## âš ï¸ è¿”ã‚Šå€¤ï¼ˆreturnï¼‰ã®æ³¨æ„

ã‚»ãƒ«ã®`return`æ–‡ã§è¿”ã™å¤‰æ•°ã¯ã€ä»–ã®ã‚»ãƒ«ã§ã‚¤ãƒ³ãƒãƒ¼ãƒˆå¯èƒ½ã«ãªã‚Šã¾ã™ã€‚ä¸è¦ãªå¤‰æ•°ã‚’è¿”ã•ãªã„ã‚ˆã†ã«æ³¨æ„ã—ã¦ãã ã•ã„ã€‚

```python
# âŒ æ‚ªã„ï¼ˆãƒ«ãƒ¼ãƒ—å¤‰æ•°ã¾ã§è¿”ã—ã¦ã„ã‚‹ï¼‰
@app.cell
def _(data):
    results = []
    for idx, item in enumerate(data):
        results.append(process(item))
    return results, idx, item  # idx, item ã¯ä¸è¦

# âœ… è‰¯ã„ï¼ˆå¿…è¦ãªå¤‰æ•°ã®ã¿è¿”ã™ï¼‰
@app.cell
def _(data):
    results = []
    for idx_proc, item_proc in enumerate(data):
        results.append(process(item_proc))
    return (results,)  # ã‚«ãƒ³ãƒã‚’å¿˜ã‚Œãšã«
```

## ğŸ› ï¸ ãƒ‡ãƒãƒƒã‚°æ™‚ã®ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

1. âœ… å„ã‚»ãƒ«ã§å›ºæœ‰ã®å¤‰æ•°åã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹ã‹ï¼Ÿ
2. âœ… ãƒ«ãƒ¼ãƒ—å¤‰æ•°ã«é©åˆ‡ãªæ¥å°¾è¾ã‚’ä»˜ã‘ã¦ã„ã‚‹ã‹ï¼Ÿ
3. âœ… `return`æ–‡ã§ä¸è¦ãªå¤‰æ•°ã‚’è¿”ã—ã¦ã„ãªã„ã‹ï¼Ÿ
4. âœ… ã‚»ãƒ«é–“ã§å¤‰æ•°åãŒè¡çªã—ã¦ã„ãªã„ã‹ï¼Ÿ

## å‚è€ƒ

- Marimoå…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ: https://docs.marimo.io/guides/reactivity.html
- å¤‰æ•°å†å®šç¾©ã‚¨ãƒ©ãƒ¼ã®è©³ç´°: https://docs.marimo.io/guides/reactivity.html#multiple-definition-error
