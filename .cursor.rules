# Cursor Rules — AI Data Lab

## コミュニケーション
- すべての回答は日本語で行う。
- 進捗報告や設計共有では要点を簡潔にまとめ、必要ならTDDの観点を添える。

## 開発プロセス
- 可能な限りテストファースト（TDD）で進め、ユニットテスト→統合テストの順で追加する。
- Serena MCPなどの検証手段がある場合は実装前後で活用し、結果を共有する。
- 既存の変更は元に戻さず、必要な場合は利用者へ確認する。

## データ分析・Notebook運用
1. **目的の明確化**
   - 分析開始前に目的・ゴール・仮説を簡潔に記述し、Notebook上でも明示する。
2. **データ品質の確保**
   - 完全性・正確性・一貫性を確認する。欠損・異常値・重複の処理方針をコードとテキストで説明する。
   - データを補完・代替値で埋める場合は理由と方法を必ず記載する。
3. **バイアスと因果**
   - 主観的バイアスを排除し、収集方法の偏りがないかを確認する。
   - 相関と因果を混同しない。因果を述べるときは仮説であることを示す。
4. **分析対象の理解**
   - カラム意味・単位・収集元・更新頻度などを把握し、必要に応じてNotebookへメモする。
5. **トレーサビリティと命名**
   - 元データを上書きせず、`raw/`, `intermediate/`, `feature/`, `output/` などの階層を用いる。
   - ファイル名だけで「ソース・対象・粒度・日付」が分かる命名（例: `bq__sales__daily__2025-03-01.parquet`）を徹底する。
   - データセット生成用スクリプトやNotebookには `dataset_` などの接頭辞を付ける。
6. **文字化け対策**
   - I/O時は `encoding='utf-8'` を明示し、他のエンコーディングを使う場合は理由を記載する。
7. **EDAと可視化**
   - NotebookにはEDAタブを設け、YData ProfilingやAutoVizなどの自動EDAツールを状況に応じて利用してよい（参考: [YData Profiling](https://docs.profiling.ydata.ai/latest/), [AutoViz](https://github.com/AutoViML/AutoViz)）。
   - Squarify（ツリーマップ）やColab Charts的な「1行可視化」スタイルのツールを活用し、色・サイズ・凡例を明示する。
   - 1つのグラフに情報を詰め込みすぎず、目的に沿って分割する。
   - 可視化結果は専門家でなくても理解できるよう説明文を添える。
8. **データセット作成の明示**
   - 新規データセットを生成する際はNotebook/READMEに目的と生成プロセスを書き、出力先ディレクトリを分ける。
9. **統計処理の妥当性**
   - 利用する統計手法の前提条件（独立性・分布など）を確認し、必要なら検証手順を示す。

## Notebook利用時の追加ルール
1. 分析目的を最初のセルに記載する。
2. 仮想環境（uvやvenv）を必ず使用し、Notebookは`edit_notebook`ツールで編集する。
3. セルには英語ラベルを用いつつ、説明は日本語で行う。
4. 勝手な分析を行わず、ファイル整理（データ/図表/レポート）を徹底する。
5. エラーが出た場合は原因と再発防止策をNotebookに追記する。
6. S3・DuckDB・JSONアクセスは既定の安全なパターン（資格情報を.envやマウントで管理）に従う。
7. 可視化や出力は標準テンプレート（目的→方法→結果→次アクション）で整理する。

## 可視化とレポート
- レポートや可視化ファイルは `reports/` 配下に保存し、Git追跡から除外する。
- グラフやテーブルは「タイトル・データ期間・単位」を明記する。
- データプロファイリング結果はNotebookに要約し、必要ならHTML/JSONを添付する。


